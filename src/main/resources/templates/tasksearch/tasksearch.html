<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@2.0.7"></script>
            <style>
                .autocomplete-wrapper {
                    position: relative;
                }
                .autocomplete-results {
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    z-index: 1000;
                    max-height: 300px;
                    overflow-y: auto;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                    margin-top: 0.5rem;
                }
                .autocomplete-results .list-group-item {
                    cursor: pointer;
                }
            </style></head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Task Search</h1>

        <div class="row">
            <!-- Search Column -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Search Tasks</h5>
                        <div class="autocomplete-wrapper">
                            <input type="text"
                                   id="task-search-input"
                                   name="query"
                                   class="form-control"
                                   placeholder="Type to search tasks..."
                                   autocomplete="off"
                                   hx-post="/tasksearch/search"
                                   hx-trigger="input changed delay:300ms, focus"
                                   hx-target="#task-dropdown"
                                   hx-swap="outerHTML"
                                   hx-on:blur="closeDropdown()">

                            <div id="task-dropdown" class="autocomplete-results" th:fragment="task-dropdown">
                                <div class="list-group" th:if="${!#lists.isEmpty(tasks)}">
                                    <a th:each="task : ${tasks}"
                                       class="list-group-item list-group-item-action"
                                       th:attr="data-task-name=${task.name}"
                                       th:hx-get="@{/tasksearch/{id}(id=${task.id})}"
                                       hx-target="#task-detail"
                                       hx-swap="innerHTML"
                                       hx-on::after-request="selectTask(this)">
                                        <span th:text="${task.name}">Task Name</span>
                                    </a>
                                </div>
                                <div class="alert alert-info mb-0" th:if="${query != null and !query.isEmpty() and #lists.isEmpty(tasks)}">
                                    No tasks found matching your search.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- Task Detail Column -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Task Details</h5>
                        <div id="task-detail">
                            <div th:fragment="task-detail" th:if="${task != null}">
                                <h3 class="card-title" th:text="${task.name}">Task Name</h3>
                                <p class="card-text text-muted" th:text="${task.description}">Description</p>
                            </div>
                            <div th:if="${task == null}" class="text-muted">
                                Select a task to view details
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function selectTask(element) {
            document.getElementById('task-search-input').value = 
                element.getAttribute('data-task-name');
            closeDropdown();
        }

        function closeDropdown() {
            setTimeout(function() {
                document.getElementById('task-dropdown').innerHTML = '';
            }, 200);
        }
    </script>
</body>
</html>
