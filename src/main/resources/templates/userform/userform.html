<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Form Validation Demo</title>
    <script src="https://unpkg.com/htmx.org@2.0.7"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        /* Hide spinner by default so it doesn't take up space */
        .htmx-indicator {
            display: none;
        }

        /* Show spinner when request is in progress */
        .htmx-indicator.htmx-request {
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="card shadow">
            <div class="card-body p-4">
                <h1 class="mb-4">User Form Validation Demo</h1>

        <div id="form-section" th:fragment="form-section" th:object="${userForm}">
            <form hx-post="/userform/validate"
                  hx-trigger="change from:input:not(#newTag), change from:select, change from:textarea delay:300ms"
                  hx-target="#form-section"
                  hx-swap="outerHTML">

                <!-- Name Field -->
                <div class="mb-3">
                    <label for="name" class="form-label">Name *</label>
                    <input type="text"
                           id="name"
                           name="name"
                           th:field="*{name}"
                           class="form-control"
                           th:classappend="${#fields.hasErrors('name')} ? 'is-invalid' : ''"
                           aria-invalid="${#fields.hasErrors('name')}">
                    <div th:if="${#fields.hasErrors('name')}"
                         th:errors="*{name}"
                         class="invalid-feedback">
                    </div>
                </div>

                <!-- Email Field -->
                <div class="mb-3">
                    <label for="email" class="form-label">Email *</label>
                    <input type="email"
                           id="email"
                           name="email"
                           th:field="*{email}"
                           class="form-control"
                           th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''"
                           aria-invalid="${#fields.hasErrors('email')}">
                    <div th:if="${#fields.hasErrors('email')}"
                         th:errors="*{email}"
                         class="invalid-feedback">
                    </div>
                </div>

                <!-- Phone Field -->
                <div class="mb-3">
                    <label for="phone" class="form-label">Phone *</label>
                    <input type="text"
                           id="phone"
                           name="phone"
                           th:field="*{phone}"
                           class="form-control"
                           th:classappend="${#fields.hasErrors('phone')} ? 'is-invalid' : ''"
                           aria-invalid="${#fields.hasErrors('phone')}"
                           placeholder="e.g., 1234567890">
                    <div th:if="${#fields.hasErrors('phone')}"
                         th:errors="*{phone}"
                         class="invalid-feedback">
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="mt-4">
                    <button type="button"
                            class="btn btn-primary"
                            hx-post="/userform/submit"
                            hx-target="#form-section"
                            hx-swap="outerHTML"
                            hx-indicator=".submit-spinner">
                        <span class="spinner-border spinner-border-sm me-2 htmx-indicator submit-spinner" aria-hidden="true"></span>
                        <span>Submit Form</span>
                    </button>
                </div>
            </form>

            <!-- Tags Section (Outside form to avoid validation trigger conflicts) -->
            <div class="mb-3 mt-4">
                <h5 class="mb-3">Tags</h5>
                <div id="tag-list" th:fragment="tag-list" class="d-flex flex-wrap gap-2 mb-3" style="min-height: auto;">
                    <span th:each="tag, iter : ${userForm.tags}"
                          class="badge bg-primary d-inline-flex align-items-center gap-1 py-1 px-2">
                        <span th:text="${tag}"></span>
                        <button type="button"
                                class="btn-close btn-close-white"
                                style="font-size: 0.5rem;"
                                hx-post="/userform/remove-tag"
                                th:hx-vals="'js:{index: ' + ${iter.index} + '}'"
                                hx-target="#tag-list"
                                hx-swap="outerHTML"
                                aria-label="Remove tag"></button>
                    </span>
                </div>

                <div class="input-group">
                    <input type="text"
                           id="newTag"
                           class="form-control"
                           placeholder="Enter a new tag">
                    <button type="button"
                            class="btn btn-primary"
                            hx-post="/userform/add-tag"
                            hx-vals='js:{newTag: document.getElementById("newTag").value}'
                            hx-target="#tag-list"
                            hx-swap="outerHTML"
                            hx-on::after-request="if(event.detail.successful) document.getElementById('newTag').value = ''">
                        Add Tag
                    </button>
                </div>
            </div>
        </div>
            </div>
        </div>
    </div>
</body>
</html>
